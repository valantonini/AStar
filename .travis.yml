language: csharp
mono: none
dist: focal
dotnet: 6.0.101
os: linux

stages:
  - build and test
  - package

jobs:
  include:
    - stage: build and test
      script:
        - dotnet restore
        - dotnet build
        - dotnet test AStar.Tests/AStar.Tests.csproj
    - stage: package
      if: tag =~ ^v
      script:
        - dotnet pack -c Release /p:PackageVersion=${TRAVIS_TAG:1}
        - dotnet nuget push AStar/bin/Release/AStarLite.${TRAVIS_TAG:1}.nupkg -s https://www.nuget.org/api/v2/package -k $NUGET_API_KEY